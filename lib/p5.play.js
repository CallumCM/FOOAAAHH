(function(e,t){"function"==typeof define&&define.amd?define("p5.play",["p5"],function(e){t(e)}):"object"==typeof exports?t(require("../p5")):t(e.p5)})(this,function(e){function t(t,o){Object.defineProperty(e.prototype,t,{configurable:!0,enumerable:!0,get:function(){var i=this instanceof e&&!this._isGlobal?this:window;return"undefined"==typeof i._p5PlayProperties&&(i._p5PlayProperties={}),t in i._p5PlayProperties||(i._p5PlayProperties[t]=o.call(i)),i._p5PlayProperties[t]}})}function o(e){if("function"!=typeof e)throw new Error("constructor must be a function");return function(){function t(){var t=Array.prototype.slice.call(arguments);return e.apply(this,[o].concat(t))}var o=this;return t.prototype=e.prototype,t}}function i(e){return function(t){var o=e[t];if("function"!=typeof o)throw new Error("\""+t+"\" is not a p5 method");return o.bind(e)}}function r(o,n,t,a,l){var d=i(o),m=d("createVector"),u=d("color"),h=d("random"),S=d("print"),w=d("push"),P=d("pop"),I=d("colorMode"),M=d("noStroke"),C=d("rectMode"),D=d("ellipseMode"),T=d("imageMode"),E=d("translate"),O=d("scale"),W=d("rotate"),N=d("stroke"),Y=d("strokeWeight"),R=d("line"),B=d("noFill"),F=d("fill"),U=d("textAlign"),H=d("textSize"),X=d("text"),k=d("rect"),j=d("cos"),z=d("sin"),L=d("atan2"),K=o.quadTree,G=o.camera,q=e.prototype.RGB,V=e.prototype.CENTER,Q=e.prototype.LEFT,J=e.prototype.BOTTOM;this.position=m(n,t),this.previousPosition=m(n,t),this.newPosition=m(n,t),this.deltaX=0,this.deltaY=0,this.velocity=m(0,0),this.maxSpeed=-1,this.friction=0,this.collider=void 0,this.colliderType="none",this.touching={},this.touching.left=!1,this.touching.right=!1,this.touching.top=!1,this.touching.bottom=!1,this.mass=1,this.immovable=!1,this.restitution=1,Object.defineProperty(this,"rotation",{enumerable:!0,get:function(){return this._rotation},set:function(e){this._rotation=e,this.rotateToDirection&&this.setSpeed(this.getSpeed(),e)}}),this._rotation=0,this.rotationSpeed=0,this.rotateToDirection=!1,this.depth=0,this.scale=1;var Z=1,$=1;this.visible=!0,this.mouseActive=!1,this.mouseIsOver=!1,this.mouseIsPressed=!1,this._internalWidth=a,this._internalHeight=l,Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,get:function(){return this._internalWidth},set:function(e){this._internalWidth=e}}),this.width=void 0===a?100:a,Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,get:function(){return this._internalHeight},set:function(e){this._internalHeight=e}}),this.height=void 0===l?100:l,this.originalWidth=this._internalWidth,this.originalHeight=this._internalHeight,this.removed=!1,this.life=-1,this.debug=!1,this.shapeColor=u(h(255),h(255),h(255)),this.groups=[];var ee={},te="";this.animation=void 0,this._drawnWithCamera=!1,this._syncAnimationSizes=function(){"default"===this.colliderType&&1!==ee[te].getWidth()&&1!==ee[te].getHeight()&&(this.collider=this.getBoundingBox(),this.colliderType="image",this._internalWidth=ee[te].getWidth()*x(this._getScaleX()),this._internalHeight=ee[te].getHeight()*x(this._getScaleY())),(ee[te].frameChanged||this.width===void 0||this.height===void 0)&&(this._internalWidth=ee[te].getWidth()*x(this._getScaleX()),this._internalHeight=ee[te].getHeight()*x(this._getScaleY()))},this.update=function(){if(!this.removed){if(this.previousPosition=this.newPosition===this.position?m(this.position.x,this.position.y):m(this.newPosition.x,this.newPosition.y),this.velocity.x*=1-this.friction,this.velocity.y*=1-this.friction,-1!==this.maxSpeed&&this.limitSpeed(this.maxSpeed),this.rotateToDirection&&0<this.velocity.mag()&&(this._rotation=this.getDirection()),this.rotation+=this.rotationSpeed,this.position.x+=this.velocity.x,this.position.y+=this.velocity.y,this.newPosition=m(this.position.x,this.position.y),this.deltaX=this.position.x-this.previousPosition.x,this.deltaY=this.position.y-this.previousPosition.y,ee[te]&&(ee[te].update(),this._syncAnimationSizes(),1==this.width&&1==this.height&&(this.width=ee[te].getWidth(),this.height=ee[te].getHeight())),this.collider){if(this.collider instanceof p){var e;e=o._angleMode===o.RADIANS?f(this.rotation):this.rotation,"custom"===this.colliderType?(this.collider.extents.x=this.collider.originalExtents.x*x(this._getScaleX())*x(j(e))+this.collider.originalExtents.y*x(this._getScaleY())*x(z(e)),this.collider.extents.y=this.collider.originalExtents.x*x(this._getScaleX())*x(z(e))+this.collider.originalExtents.y*x(this._getScaleY())*x(j(e))):"default"===this.colliderType?(this.collider.extents.x=this._internalWidth*x(this._getScaleX())*x(j(e))+this._internalHeight*x(this._getScaleY())*x(z(e)),this.collider.extents.y=this._internalWidth*x(this._getScaleX())*x(z(e))+this._internalHeight*x(this._getScaleY())*x(j(e))):"image"===this.colliderType&&(this.collider.extents.x=this._internalWidth*x(j(e))+this._internalHeight*x(z(e)),this.collider.extents.y=this._internalWidth*x(z(e))+this._internalHeight*x(j(e)))}this.collider instanceof s&&(this.collider.radius=this.collider.originalRadius*x(this.scale))}this.mouseActive?(!this.collider&&this.setDefaultCollider(),this.mouseUpdate()):("function"==typeof this.onMouseOver||"function"==typeof this.onMouseOut||"function"==typeof this.onMousePressed||"function"==typeof this.onMouseReleased)&&(this.mouseActive=!0,!this.collider&&this.setDefaultCollider(),this.mouseUpdate()),0<this.life&&this.life--,0===this.life&&this.remove()}},this.setDefaultCollider=function(){ee[te]&&1!==ee[te].getWidth()&&1!==ee[te].getHeight()?(this.collider=this.getBoundingBox(),this._internalWidth=ee[te].getWidth()*x(this._getScaleX()),this._internalHeight=ee[te].getHeight()*x(this._getScaleY()),this.colliderType="image"):ee[te]&&1===ee[te].getWidth()&&1===ee[te].getHeight()||(this.collider=new p(o,this.position,m(this._internalWidth,this._internalHeight)),this.colliderType="default"),o.quadTree.insert(this)},this.mouseUpdate=function(){var e=this.mouseIsOver,t=this.mouseIsPressed;this.mouseIsOver=!1,this.mouseIsPressed=!1;var i;i=this._drawnWithCamera?m(G.mouseX,G.mouseY):m(o.mouseX,o.mouseY),this.collider&&(this.collider instanceof s?v(i.x,i.y,this.collider.center.x,this.collider.center.y)<this.collider.radius&&(this.mouseIsOver=!0):this.collider instanceof p&&i.x>this.collider.left()&&i.y>this.collider.top()&&i.x<this.collider.right()&&i.y<this.collider.bottom()&&(this.mouseIsOver=!0),this.mouseIsOver&&o.mouseIsPressed&&(this.mouseIsPressed=!0),!e&&this.mouseIsOver&&this.onMouseOver!==void 0&&("function"==typeof this.onMouseOver?this.onMouseOver.call(this,this):S("Warning: onMouseOver should be a function")),e&&!this.mouseIsOver&&this.onMouseOut!==void 0&&("function"==typeof this.onMouseOut?this.onMouseOut.call(this,this):S("Warning: onMouseOut should be a function")),!t&&this.mouseIsPressed&&this.onMousePressed!==void 0&&("function"==typeof this.onMousePressed?this.onMousePressed.call(this,this):S("Warning: onMousePressed should be a function")),t&&!o.mouseIsPressed&&!this.mouseIsPressed&&this.onMouseReleased!==void 0&&("function"==typeof this.onMouseReleased?this.onMouseReleased.call(this,this):S("Warning: onMouseReleased should be a function")))},this.setCollider=function(e,t,i,r,n){if("rectangle"!==e&&"circle"!==e)throw new TypeError("setCollider expects the first argument to be either \"circle\" or \"rectangle\"");else if("circle"===e&&1<arguments.length&&4>arguments.length)throw new TypeError("Usage: setCollider(\"circle\") or setCollider(\"circle\", offsetX, offsetY, radius)");else if("circle"===e&&4<arguments.length)o._warn("Extra parameters to setCollider were ignored. Usage: setCollider(\"circle\") or setCollider(\"circle\", offsetX, offsetY, radius)");else if("rectangle"===e&&1<arguments.length&&5>arguments.length)throw new TypeError("Usage: setCollider(\"rectangle\") or setCollider(\"rectangle\", offsetX, offsetY, width, height)");else"rectangle"===e&&5<arguments.length&&o._warn("Extra parameters to setCollider were ignored. Usage: setCollider(\"rectangle\") or setCollider(\"rectangle\", offsetX, offsetY, width, height)");this.colliderType="custom";var a=m(t,i);"rectangle"===e&&1===arguments.length?this.collider=new p(o,this.position,m(this.width,this.height)):"rectangle"===e&&5<=arguments.length?this.collider=new p(o,this.position,m(r,n),a):"circle"===e&&1===arguments.length?this.collider=new s(o,this.position,Math.floor(Math.max(this.width,this.height)/2)):"circle"==e&&4<=arguments.length&&(this.collider=new s(o,this.position,r,a)),K.insert(this)},this.getBoundingBox=function(){var e=ee[te].getWidth()*x(this._getScaleX()),t=ee[te].getHeight()*x(this._getScaleY());return 1==e&&1===t?new p(o,this.position,m(e,t)):new p(o,this.position,m(e,t))},this.mirrorX=function(e){return 1===e||-1===e?void(Z=e):Z},this.mirrorY=function(e){return 1===e||-1===e?void($=e):$},this._getScaleX=function(){return this.scale},this._getScaleY=function(){return this.scale},this.display=function(){this.visible&&!this.removed&&(w(),I(q),M(),C(V),D(V),T(V),E(this.position.x,this.position.y),O(this._getScaleX()*Z,this._getScaleY()*$),o._angleMode===o.RADIANS?W(f(this.rotation)):W(this.rotation),this.draw(),P(),this._drawnWithCamera=G.active,this.debug&&(w(),N(0,255,0),Y(1),R(this.position.x-10,this.position.y,this.position.x+10,this.position.y),R(this.position.x,this.position.y-10,this.position.x,this.position.y+10),B(),M(),F(0,255,0),U(Q,J),H(16),X(this.depth+"",this.position.x+4,this.position.y-2),B(),N(0,255,0),this.collider!==void 0&&this.collider.draw(),P()))},this.draw=function(){""!==te&&ee?ee[te]&&ee[te].draw(0,0,0):(M(),F(this.shapeColor),k(0,0,this._internalWidth,this._internalHeight))},this.remove=function(){for(this.removed=!0,K.removeObject(this);0<this.groups.length;)this.groups[0].remove(this)},this.setVelocity=function(e,t){this.velocity.x=e,this.velocity.y=t},this.getSpeed=function(){return this.velocity.mag()},this.getDirection=function(){var e=L(this.velocity.y,this.velocity.x);return isNaN(e)&&(e=0),o._angleMode===o.RADIANS&&(e=_(e)),e},this.addToGroup=function(e){e instanceof Array?e.add(this):S("addToGroup error: "+e+" is not a group")},this.limitSpeed=function(e){var t=this.getSpeed();if(x(t)>e){var o=e/x(t);this.velocity.x*=o,this.velocity.y*=o}},this.setSpeed=function(e,t){var i;i="undefined"==typeof t?0!==this.velocity.x||0!==this.velocity.y?o.atan2(this.velocity.y,this.velocity.x):o._angleMode===o.RADIANS?f(this._rotation):this._rotation:o._angleMode===o.RADIANS?f(t):t,this.velocity.x=j(i)*e,this.velocity.y=z(i)*e},this.addSpeed=function(e,t){var i;i=o._angleMode===o.RADIANS?f(t):t,this.velocity.x+=j(i)*e,this.velocity.y+=z(i)*e},this.attractionPoint=function(e,t,o){var i=L(o-this.position.y,t-this.position.x);this.velocity.x+=j(i)*e,this.velocity.y+=z(i)*e},this.addImage=function(){if("string"==typeof arguments[0]&&arguments[1]instanceof e.Image)this.addAnimation(arguments[0],arguments[1]);else if(arguments[0]instanceof e.Image)this.addAnimation("normal",arguments[0]);else throw"addImage error: allowed usages are <image> or <label>, <image>"},this.addAnimation=function(e){var t;if("string"!=typeof e)return S("Sprite.addAnimation error: the first argument must be a label (String)"),-1;if(2>arguments.length)return S("addAnimation error: you must specify a label and n frame images"),-1;if(arguments[1]instanceof g){var r=arguments[1],n=r.clone();return ee[e]=n,""===te&&(te=e,this.animation=n),n.isSpriteAnimation=!0,this._internalWidth=n.getWidth()*x(this._getScaleX()),this._internalHeight=n.getHeight()*x(this._getScaleY()),n}for(var a=[],l=1;l<arguments.length;l++)a.push(arguments[l]);return t=y(o.Animation,a),ee[e]=t,""===te&&(te=e,this.animation=t),t.isSpriteAnimation=!0,this._internalWidth=t.getWidth()*x(this._getScaleX()),this._internalHeight=t.getHeight()*x(this._getScaleY()),t},this.changeImage=function(e){this.changeAnimation(e)},this.getAnimationLabel=function(){return te},this.changeAnimation=function(e){ee[e]?(te=e,this.animation=ee[e]):S("changeAnimation error: no animation labeled "+e)},this.overlapPixel=function(e,t){var o=m(e,t),i=this.animation.getFrameImage();if(o.x-=this.position.x-i.width/2,o.y-=this.position.y-i.height/2,0>o.x||o.x>i.width||0>o.y||o.y>i.height)return!1;if(0===this.rotation&&1===this.scale){var r=i.get(o.x,o.y);return 255===r[3]}return S("Error: overlapPixel doesn't work with scaled or rotated sprites yet"),!1},this.overlapPoint=function(e,t){var o=m(e,t);if(this.collider||this.setDefaultCollider(),void 0!==this.collider){if(this.collider instanceof p)return o.x>this.collider.left()&&o.x<this.collider.right()&&o.y>this.collider.top()&&o.y<this.collider.bottom();if(this.collider instanceof s){var i=this.collider.radius*this.collider.radius,r=b(this.collider.center.x-o.x,2)+b(this.collider.center.y-o.y,2);return r<i}return!1}return!1},this.overlap=function(e,t){return this.AABBops("overlap",e,t)},this.collide=function(e,t){return this.AABBops("collide",e,t)},this.displace=function(e,t){return this.AABBops("displace",e,t)},this.bounce=function(e,t){return this.AABBops("bounce",e,t)},this.AABBops=function(t,n,a){this.touching.left=!1,this.touching.right=!1,this.touching.top=!1,this.touching.bottom=!1;var l=!1,d=[];if(n instanceof r)d.push(n);else if(n instanceof Array)void 0!==K&&K.active&&(d=K.retrieveFromGroup(this,n)),0===d.length&&(d=n);else throw"Error: overlap can only be checked between sprites or groups";for(var g=0;g<d.length;g++)if(this!==d[g]&&!this.removed){var y,u=d[g];if(void 0===this.collider&&this.setDefaultCollider(),void 0===u.collider&&u.setDefaultCollider(),void 0!==this.collider&&void 0!==u.collider)if("overlap"===t){var h;h=this.collider instanceof s?u.collider.overlap(this.collider):this.collider.overlap(u.collider),h&&(l=!0,void 0!==a&&"function"==typeof a&&a.call(this,this,u))}else if("collide"===t||"displace"===t||"bounce"===t){y=m(0,0);var f=x(this.velocity.x-u.velocity.x)>=u.collider.extents.x/2&&0===A(this.deltaX-this.velocity.x),v=x(this.velocity.y-u.velocity.y)>=u.collider.size().y/2&&0===A(this.deltaY-this.velocity.y);if(f||v){var _=m((this.position.x+this.previousPosition.x)/2,(this.position.y+this.previousPosition.y)/2),c=m(x(this.position.x-this.previousPosition.x)+this.collider.extents.x,x(this.position.y-this.previousPosition.y)+this.collider.extents.y),b=new p(o,_,c,this.collider.offset);b.overlap(u.collider)&&(f&&(0>this.velocity.x?y.x=u.collider.right()-this.collider.left()+1:0<this.velocity.x&&(y.x=u.collider.left()-this.collider.right()-1)),v&&(0<this.velocity.y?y.y=u.collider.top()-this.collider.bottom()-1:0>this.velocity.y&&(y.y=u.collider.bottom()-this.collider.top()+1)))}else y=this.collider instanceof s?u.collider.collide(this.collider).mult(-1):this.collider.collide(u.collider);if(0!==y.x||0!==y.y){var S,w,P,I;if("displace"!==t||u.immovable?("collide"===t||"bounce"===t)&&!this.immovable&&(this.position.add(y),this.previousPosition=m(this.position.x,this.position.y),this.newPosition=m(this.position.x,this.position.y)):u.position.sub(y),0<y.x&&(this.touching.left=!0),0>y.x&&(this.touching.right=!0),0>y.y&&(this.touching.bottom=!0),0<y.y&&(this.touching.top=!0),"bounce"===t)if(this.collider instanceof s&&u.collider instanceof s){var M=e.Vector.sub(this.position,u.position),C=e.Vector.sub(u.position,this.position),D=M.magSq(),T=this.mass+u.mass,E=0,O=0;this.immovable?O=2:u.immovable?E=2:(E=2*u.mass/T,O=2*this.mass/T);var W=M.mult(E*e.Vector.sub(this.velocity,u.velocity).dot(M)/D),N=C.mult(O*e.Vector.sub(u.velocity,this.velocity).dot(C)/D);this.velocity.sub(W.mult(this.restitution)),u.velocity.sub(N.mult(u.restitution))}else u.immovable?(S=-this.velocity.x+u.velocity.x,w=-this.velocity.y+u.velocity.y):(S=(this.velocity.x*(this.mass-u.mass)+2*u.mass*u.velocity.x)/(this.mass+u.mass),w=(this.velocity.y*(this.mass-u.mass)+2*u.mass*u.velocity.y)/(this.mass+u.mass),P=(u.velocity.x*(u.mass-this.mass)+2*this.mass*this.velocity.x)/(this.mass+u.mass),I=(u.velocity.y*(u.mass-this.mass)+2*this.mass*this.velocity.y)/(this.mass+u.mass)),x(y.x)>x(y.y)&&(!this.immovable&&(this.velocity.x=S*this.restitution),!u.immovable&&(u.velocity.x=P*u.restitution)),x(y.x)<x(y.y)&&(!this.immovable&&(this.velocity.y=w*this.restitution),!u.immovable&&(u.velocity.y=I*u.restitution));void 0!==a&&"function"==typeof a&&a.call(this,this,u),l=!0}}}return l}}function n(e,t,o,i){this.position=e.createVector(t,o),this.zoom=i,this.mouseX=e.mouseX,this.mouseY=e.mouseY,this.active=!1,this.on=function(){this.active||(a.call(e),this.active=!0)},this.off=function(){this.active&&(l.call(e),this.active=!1)}}function a(){var e=this,t=e.camera;t.init||0!==t.position.x||0!==t.position.y||(t.position.x=e.width/2,t.position.y=e.height/2,t.init=!0),t.mouseX=e.mouseX+t.position.x-e.width/2,t.mouseY=e.mouseY+t.position.y-e.height/2,t.active||(t.active=!0,e.push(),e.scale(t.zoom),e.translate(-t.position.x+e.width/2/t.zoom,-t.position.y+e.height/2/t.zoom))}function l(){var e=this;e.camera.active&&(e.pop(),e.camera.active=!1)}function s(t,o,r,n){var a=i(t),l=a("createVector"),s=e.prototype.CENTER;this.center=o,this.radius=r,this.originalRadius=r,this.offset=void 0===n?l(0,0):n,this.extents=l(2*r,2*r),this.draw=function(){t.noFill(),t.stroke(0,255,0),t.rectMode(s),t.ellipse(this.center.x+this.offset.x,this.center.y+this.offset.y,2*this.radius,2*this.radius)},this.overlap=function(e){var t=this.radius+e.radius;t*=t;var o=this.center.x+this.offset.x,i=this.center.y+this.offset.y,n=e.center.x+e.offset.x,a=e.center.y+e.offset.y,l=b(o-n,2)+b(i-a,2);return t>l},this.collide=function(e){if(this.overlap(e)){var o=this.center.x+this.offset.x,i=this.center.y+this.offset.y,r=e.center.x+e.offset.x,n=e.center.y+e.offset.y,s=t.atan2(i-n,o-r),a=this.radius+e.radius,d=x(a-v(o,i,r,n)),c=l(t.cos(s)*d,t.sin(s)*d);return c}return l(0,0)},this.size=function(){return l(2*this.radius,2*this.radius)},this.left=function(){return this.center.x+this.offset.x-this.radius},this.right=function(){return this.center.x+this.offset.x+this.radius},this.top=function(){return this.center.y+this.offset.y-this.radius},this.bottom=function(){return this.center.y+this.offset.y+this.radius}}function p(o,r,n,a){var l=i(o),c=l("createVector"),g=e.prototype.CENTER,m=e.prototype.PI;this.center=r,this.extents=n,this.originalExtents=n.copy(),this.offset=void 0===a?c(0,0):a,this.min=function(){return c(this.center.x+this.offset.x-this.extents.x,this.center.y+this.offset.y-this.extents.y)},this.max=function(){return c(this.center.x+this.offset.x+this.extents.x,this.center.y+this.offset.y+this.extents.y)},this.right=function(){return this.center.x+this.offset.x+this.extents.x/2},this.left=function(){return this.center.x+this.offset.x-this.extents.x/2},this.top=function(){return this.center.y+this.offset.y-this.extents.y/2},this.bottom=function(){return this.center.y+this.offset.y+this.extents.y/2},this.size=function(){return c(2*this.extents.x,2*this.extents.y)},this.rotate=function(e){var i=o._angleMode===o.RADIANS?f(e):e;var t=this.extents.x*x(o.cos(i))+this.extents.y*x(o.sin(i)),r=this.extents.x*x(o.sin(i))+this.extents.y*x(o.cos(i));this.extents.x=t,this.extents.y=r},this.draw=function(){o.noFill(),o.stroke(0,255,0),o.rectMode(g),o.rect(this.center.x+this.offset.x,this.center.y+this.offset.y,this.size().x/2,this.size().y/2)},this.overlap=function(e){if(e instanceof p){var t=e.minkowskiDifference(this);return!!(0>=t.min().x&&0<=t.max().x&&0>=t.min().y&&0<=t.max().y)}if(e instanceof s){var o=c(e.center.x,e.center.y);e.center.x<this.left()?o.x=this.left():e.center.x>this.right()&&(o.x=this.right()),e.center.y<this.top()?o.y=this.top():e.center.y>this.bottom()&&(o.y=this.bottom());var i=o.dist(e.center);return i<e.radius}},this.collide=function(e){if(e instanceof p){var t=e.minkowskiDifference(this);if(0>=t.min().x&&0<=t.max().x&&0>=t.min().y&&0<=t.max().y){var i=t.closestPointOnBoundsToPoint(c(0,0));return i}return c(0,0)}if(e instanceof s){var r=c(e.center.x,e.center.y);e.center.x<this.left()?r.x=this.left():e.center.x>this.right()&&(r.x=this.right()),e.center.y<this.top()?r.y=this.top():e.center.y>this.bottom()&&(r.y=this.bottom());var n,l=r.dist(e.center);if(l<e.radius){if(r.x===e.center.x&&r.y===e.center.y){var g=r.x-this.center.x,y=r.y-this.center.y;x(g)<x(y)?0<g?r.x=this.right():r.x=this.left():0>y?r.y=this.top():r.y=this.bottom(),n=o.atan2(e.center.y-r.y,e.center.x-r.x),0===n&&(r.x===this.right()&&(n=m),r.y===this.top()&&(n=m/2),r.y===this.bottom()&&(n=-m/2))}else n=o.atan2(r.y-e.center.y,r.x-e.center.x);var u=c(r.x-e.center.x,r.y-e.center.y),d=c(o.cos(n)*e.radius-u.x,o.sin(n)*e.radius-u.y);return d}return c(0,0)}},this.minkowskiDifference=function(e){var t=this.min().sub(e.max()),i=this.size().add(e.size());return new p(o,t.add(i.div(2)),i.div(2))},this.closestPointOnBoundsToPoint=function(e){var t=x(e.x-this.min().x),o=c(this.min().x,e.y);return x(this.max().x-e.x)<t&&(t=x(this.max().x-e.x),o=c(this.max().x,e.y)),x(this.max().y-e.y)<t&&(t=x(this.max().y-e.y),o=c(e.x,this.max().y)),x(this.min().y-e.y)<t&&(t=x(this.min.y-e.y),o=c(e.x,this.min().y)),o}}function g(o){var r,n=Array.prototype.slice.call(arguments,1),a=e.prototype.CENTER;this.images=[];var l=0,s=0,d=-1;if(this.offX=0,this.offY=0,this.frameDelay=4,this.playing=!0,this.visible=!0,this.looping=!0,this.frameChanged=!1,this.imageCollider=!1,2===n.length&&"string"==typeof n[0]&&"string"==typeof n[1]){var c=n[0],p=n[1],y=c.substring(c.length-4,c.length);".png"!==y&&(o.print("Animation error: you need to use .png files (filename "+c+")"),c=-1);var u=p.substring(p.length-4,p.length);if(".png"!==u&&(o.print("Animation error: you need to use .png files (filename "+p+")"),p=-1),-1!==c&&-1!==p){var h=0,x=0;for(r=c.length-4;0<=r&&"0"<=c.charAt(r)&&"9">=c.charAt(r);r--)h++;for(r=p.length-4;0<=r&&"0"<=p.charAt(r)&&"9">=p.charAt(r);r--)x++;var v=c.substring(0,c.length-(4+h)),_=p.substring(0,p.length-(4+x)),b=parseInt(c.substring(c.length-(4+h),c.length-4),10),A=parseInt(p.substring(p.length-(4+x),p.length-4),10);if(A<b){var S=A;A=b,b=S}if(v!==_)this.images.push(o.loadImage(c)),this.images.push(o.loadImage(p));else{var t;if(h===x)for(r=b;r<=A;r++)t=v+o.nf(r,h)+".png",this.images.push(o.loadImage(t));else for(r=b;r<=A;r++)t=v+r+".png",this.images.push(o.loadImage(t))}}}else if(1===n.length&&n[0]instanceof m)this.spriteSheet=n[0],this.images=this.spriteSheet.frames;else if(0!==n.length)for(r=0;r<n.length;r++)n[r]instanceof e.Image?this.images.push(n[r]):this.images.push(o.loadImage(n[r]));this.clone=function(){var e=new g(o);return e.images=[],this.spriteSheet&&(e.spriteSheet=this.spriteSheet.clone()),e.images=this.images.slice(),e.offX=this.offX,e.offY=this.offY,e.frameDelay=this.frameDelay,e.playing=this.playing,e.looping=this.looping,e},this.draw=function(e,t,i){if(this.xpos=e,this.ypos=t,this.rotation=i||0,this.visible){if(this.isSpriteAnimation||this.update(),o.push(),o.imageMode(a),o.translate(this.xpos,this.ypos),o._angleMode===o.RADIANS?o.rotate(f(this.rotation)):o.rotate(this.rotation),void 0===this.images[l])o.print("Warning undefined frame "+l);else if(this.spriteSheet){var r=this.images[l].frame;o.image(this.spriteSheet.image,this.offX,this.offY,r.width,r.height,r.x,r.y,r.width,r.height)}else o.image(this.images[l],this.offX,this.offY);o.pop()}},this.update=function(){s++;var e=l;this.frameChanged=!1,1===this.images.length&&(this.playing=!1,l=0),this.playing&&0==s%this.frameDelay&&(d>l&&-1!==d?l++:d<l&&-1!==d?l--:d===l&&-1!==d?this.playing=!1:this.looping?l>=this.images.length-1?l=0:l++:l<this.images.length-1&&l++),l==this.images.length-1&&null!=this.onComplete&&this.onComplete(),e!==l&&(this.frameChanged=!0)},this.play=function(){this.playing=!0,d=-1},this.stop=function(){this.playing=!1},this.rewind=function(){l=0},this.onComplete=function(){},this.changeFrame=function(e){l=e<this.images.length?e:this.images.length-1,d=-1},this.nextFrame=function(){l<this.images.length-1?++l:this.looping&&(l=0),d=-1,this.playing=!1},this.previousFrame=function(){0<l?--l:this.looping&&(l=this.images.length-1),d=-1,this.playing=!1},this.goToFrame=function(e){0>e||e>=this.images.length||(d=e,d!==l&&(this.playing=!0))},this.getFrame=function(){return l},this.getLastFrame=function(){return this.images.length-1},this.getFrameImage=function(){return this.images[l]},this.getImageAt=function(e){return this.images[e]},this.getWidth=function(){return this.images[l]instanceof e.Image?this.images[l].width:this.images[l]?this.images[l].frame.width:1},this.getHeight=function(){return this.images[l]instanceof e.Image?this.images[l].height:this.images[l]?this.images[l].frame.height:1}}function m(t){var o=Array.prototype.slice.call(arguments,1);this.image=null,this.frames=[],this.frame_width=0,this.frame_height=0,this.num_frames=0,this._generateSheetFrames=function(){for(var e=0,t=0,o=0;o<this.num_frames;o++)this.frames.push({name:o,frame:{x:e,y:t,width:this.frame_width,height:this.frame_height}}),e+=this.frame_width,e>=this.image.width&&(e=0,t+=this.frame_height,t>=this.image.height&&(t=0))},2===o.length&&Array.isArray(o[1])?(this.frames=o[1],this.num_frames=this.frames.length):4===o.length&&"number"==typeof o[1]&&"number"==typeof o[2]&&"number"==typeof o[3]&&(this.frame_width=o[1],this.frame_height=o[2],this.num_frames=o[3]),o[0]instanceof e.Image?(this.image=o[0],4===o.length&&this._generateSheetFrames()):2===o.length?this.image=t.loadImage(o[0]):4===o.length&&(this.image=t.loadImage(o[0],this._generateSheetFrames.bind(this))),this.drawFrame=function(e,o,r,n,a){var l;if("number"==typeof e)l=this.frames[e].frame;else for(var s=0;s<this.frames.length;s++)if(this.frames[s].name===e){l=this.frames[s].frame;break}var d=n||l.width,c=a||l.height;t.image(this.image,o,r,d,c,l.x,l.y,l.width,l.height)},this.clone=function(){for(var e=new m(t),o=0;o<this.frames.length;o++){var r=this.frames[o].frame,n={name:r.name,frame:{x:r.x,y:r.y,width:r.width,height:r.height}};e.frames.push(n)}return e.image=this.image,e.frame_width=this.frame_width,e.frame_height=this.frame_height,e.num_frames=this.num_frames,e}}function y(e,t){function o(){return e.apply(this,t)}return o.prototype=e.prototype,new o}function u(e,t,o,i){this.active=!0,this.max_objects=t||10,this.max_levels=o||4,this.level=i||0,this.bounds=e,this.objects=[],this.object_refs=[],this.nodes=[]}e.prototype.registerMethod("init",function(){this.camera=new n(this,0,0,1),this.camera.init=!1});var x=e.prototype.abs,f=e.prototype.radians,v=e.prototype.dist,_=e.prototype.degrees,b=e.prototype.pow,A=e.prototype.round;t("allSprites",function(){return new e.prototype.Group}),e.prototype.spriteUpdate=!0,e.prototype.createSprite=function(e,t,o,i){var n=new r(this,e,t,o,i);return n.depth=this.allSprites.maxDepth()+1,this.allSprites.add(n),n},e.prototype.removeSprite=function(e){e.remove()},e.prototype.updateSprites=function(e){if(!1===e&&(this.spriteUpdate=!1),!0===e&&(this.spriteUpdate=!0),this.spriteUpdate)for(var t=0;t<this.allSprites.size();t++)this.allSprites.get(t).update()},e.prototype.getSprites=function(){if(0===arguments.length)return this.allSprites.toArray();for(var e=[],t=0;t<arguments.length;t++)for(var o=0;o<this.allSprites.size();o++)this.allSprites.get(o).isTagged(arguments[t])&&e.push(this.allSprites.get(o));return e},e.prototype.drawSprites=function(e){if(e=e||this.allSprites,"function"!=typeof e.draw)throw"Error: with drawSprites you can only draw all sprites or a group";e.draw()},e.prototype.drawSprite=function(e){e&&e.display()},e.prototype.loadAnimation=function(){return y(this.Animation,arguments)},e.prototype.loadSpriteSheet=function(){return y(this.SpriteSheet,arguments)},e.prototype.animation=function(e,t,o){e.draw(t,o)},t("_p5play",function(){return{keyStates:{},mouseStates:{}}});var S=1,w=2,P=3;e.prototype.keyWentDown=function(e){return this._isKeyInState(e,S)},e.prototype.keyWentUp=function(e){return this._isKeyInState(e,P)},e.prototype.keyDown=function(e){return this._isKeyInState(e,w)},e.prototype._isKeyInState=function(e,t){var o,i=this._p5play.keyStates;return o="string"==typeof e?this._keyCodeFromAlias(e):e,void 0===i[o]&&(this.keyIsDown(o)?i[o]=w:i[o]=0),i[o]===t},e.prototype.mouseDown=function(e){return this._isMouseButtonInState(e,w)},e.prototype.mouseUp=function(e){return this._isMouseButtonInState(e,0)},e.prototype.mouseWentUp=function(e){return this._isMouseButtonInState(e,P)},e.prototype.mouseWentDown=function(e){return this._isMouseButtonInState(e,S)},e.prototype._isMouseButtonInState=function(e,t){var o=this._p5play.mouseStates;return void 0===e&&(e=this.LEFT),void 0===o[e]&&(this.mouseIsPressed&&this.mouseButton===e?o[e]=w:o[e]=0),o[e]===t},e.prototype.KEY={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32," ":32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT_ARROW:37,LEFT:37,UP_ARROW:38,UP:38,RIGHT_ARROW:39,RIGHT:39,DOWN_ARROW:40,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"0NUMPAD":96,"1NUMPAD":97,"2NUMPAD":98,"3NUMPAD":99,"4NUMPAD":100,"5NUMPAD":101,"6NUMPAD":102,"7NUMPAD":103,"8NUMPAD":104,"9NUMPAD":105,MULTIPLY:106,PLUS:107,MINUS:109,DOT:110,SLASH1:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,EQUAL:187,COMMA:188,SLASH:191,BACKSLASH:220},e.prototype.KEY_DEPRECATIONS={MINUT:"MINUS",COMA:"COMMA"},e.prototype._keyCodeFromAlias=function(e){return e=e.toUpperCase(),this.KEY_DEPRECATIONS[e]&&(this._warn("Key literal \""+e+"\" is deprecated and may be removed in a future version of p5.play. Please use \""+this.KEY_DEPRECATIONS[e]+"\" instead."),e=this.KEY_DEPRECATIONS[e]),this.KEY[e]},e.prototype.readPresses=function(){var e=this._p5play.keyStates,t=this._p5play.mouseStates;for(var o in e)e[o]=this.keyIsDown(o)?0===e[o]?S:w:e[o]===w?P:0;for(var i in t)t[i]=this.mouseIsPressed&&this.mouseButton===i?0===t[i]?S:w:t[i]===w?P:0},e.prototype.useQuadTree=function(e){if(this.quadTree!==void 0){if(e===void 0)return this.quadTree.active;this.quadTree.active=!!e}else return!1},t("quadTree",function(){return new u({x:0,y:0,width:0,height:0},4)}),t("Sprite",o(r)),t("Camera",o(n)),e.prototype.Group=function(){function e(e,t){return null===e||null===t?null===e&&null===t:"string"==typeof e?e===t:"object"==typeof e?e.equals instanceof Function?e.equals(t):e===t:e===t}function t(e,t,o){for(var r=!1,n=0;n<this.size();n++)r=this.get(n).AABBops(e,t,o)||r;return r}var o=[];return o.get=function(e){return o[e]},o.contains=function(e){return-1<this.indexOf(e)},o.indexOf=function(t){for(var r=0,n=o.length;r<n;++r)if(e(t,o[r]))return r;return-1},o.add=function(e){if(!(e instanceof r))throw"Error: you can only add sprites to a group";-1===this.indexOf(e)&&(o.push(e),e.groups.push(this))},o.size=function(){return o.length},o.removeSprites=function(){for(;0<o.length;)o[0].remove()},o.clear=function(){o.length=0},o.remove=function(e){if(!(e instanceof r))throw"Error: you can only remove sprites from a group";var t,n=!1;for(t=o.length-1;0<=t;t--)o[t]===e&&(o.splice(t,1),n=!0);if(n)for(t=e.groups.length-1;0<=t;t--)e.groups[t]===this&&e.groups.splice(t,1);return n},o.toArray=function(){return o.slice(0)},o.maxDepth=function(){return 0===o.length?0:o.reduce(function(e,t){return Math.max(e,t.depth)},-Infinity)},o.minDepth=function(){return 0===o.length?99999:o.reduce(function(e,t){return Math.min(e,t.depth)},1/0)},o.draw=function(){this.sort(function(e,t){return e.depth-t.depth});for(var e=0;e<this.size();e++)this.get(e).display()},o.overlap=t.bind(o,"overlap"),o.collide=t.bind(o,"collide"),o.displace=t.bind(o,"displace"),o.bounce=t.bind(o,"bounce"),o},t("CircleCollider",o(s)),t("AABB",o(p)),t("Animation",o(g)),t("SpriteSheet",o(m)),u.prototype.updateBounds=function(){for(var e=this.getAll(),t=1e4,o=1e4,r=-1e4,n=-1e4,a=0;a<e.length;a++)e[a].position.x<t&&(t=e[a].position.x),e[a].position.y<o&&(o=e[a].position.y),e[a].position.x>r&&(r=e[a].position.x),e[a].position.y>n&&(n=e[a].position.y);this.bounds={x:t,y:o,width:r,height:n}},u.prototype.split=function(){var e=this.level+1,t=Math.round(this.bounds.width/2),o=Math.round(this.bounds.height/2),i=Math.round(this.bounds.x),r=Math.round(this.bounds.y);this.nodes[0]=new u({x:i+t,y:r,width:t,height:o},this.max_objects,this.max_levels,e),this.nodes[1]=new u({x:i,y:r,width:t,height:o},this.max_objects,this.max_levels,e),this.nodes[2]=new u({x:i,y:r+o,width:t,height:o},this.max_objects,this.max_levels,e),this.nodes[3]=new u({x:i+t,y:r+o,width:t,height:o},this.max_objects,this.max_levels,e)},u.prototype.getIndex=function(e){if(!e.collider)return-1;var t=-1,o=this.bounds.x+this.bounds.width/2,i=this.bounds.y+this.bounds.height/2,r=e.collider.top()<i&&e.collider.top()+e.collider.size().y<i,n=e.collider.top()>i;return e.collider.left()<o&&e.collider.left()+e.collider.size().x<o?r?t=1:n&&(t=2):e.collider.left()>o&&(r?t=0:n&&(t=3)),t},u.prototype.insert=function(e){if(-1===this.objects.indexOf(e)){var t,o=0;if("undefined"!=typeof this.nodes[0]&&(t=this.getIndex(e),-1!==t))return void this.nodes[t].insert(e);if(this.objects.push(e),this.objects.length>this.max_objects&&this.level<this.max_levels)for("undefined"==typeof this.nodes[0]&&this.split();o<this.objects.length;)t=this.getIndex(this.objects[o]),-1===t?++o:this.nodes[t].insert(this.objects.splice(o,1)[0])}},u.prototype.retrieve=function(e){var t=this.getIndex(e),o=this.objects;if("undefined"!=typeof this.nodes[0])if(-1!==t)o=o.concat(this.nodes[t].retrieve(e));else for(var r=0;r<this.nodes.length;++r)o=o.concat(this.nodes[r].retrieve(e));return o},u.prototype.retrieveFromGroup=function(e,t){for(var o=[],r=this.retrieve(e),n=0;n<r.length;n++)t.contains(r[n])&&o.push(r[n]);return o},u.prototype.getAll=function(){for(var e=this.objects,t=0;t<this.nodes.length;++t)e=e.concat(this.nodes[t].getAll());return e},u.prototype.getObjectNode=function(e){var t;if(!this.nodes.length)return this;if(t=this.getIndex(e),-1===t)return this;var o=this.nodes[t].getObjectNode(e);return!!o&&o},u.prototype.removeObject=function(e){var t=this.getObjectNode(e),o=t.objects.indexOf(e);return-1!==o&&void t.objects.splice(o,1)},u.prototype.clear=function(){if(this.objects=[],!!this.nodes.length){for(var e=0;e<this.nodes.length;++e)this.nodes[e].clear();this.nodes=[]}},u.prototype.cleanup=function(){var e=this.getAll();this.clear();for(var t=0;t<e.length;t++)this.insert(e[t])},e.prototype.registerMethod("pre",e.prototype.readPresses),e.prototype.registerMethod("pre",e.prototype.updateSprites),e.prototype.registerMethod("post",function(){this.quadTree.active&&(this.quadTree.updateBounds(),this.quadTree.cleanup())}),e.prototype.registerMethod("pre",a),e.prototype.registerMethod("post",l),e.prototype._warn=function(e){var t=window.console;t&&("function"==typeof t.warn?t.warn(e):"function"==typeof t.log&&t.log("Warning: "+e))}});